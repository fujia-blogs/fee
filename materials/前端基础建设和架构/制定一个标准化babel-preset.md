# 前端工具链生态，制定一个标准化 babel-preset

## 要点

1，公共库的模块化规范、编译标准，甚⾄压缩⽅式都有讲究，同时公共库与使⽤它们的业务项⽬也要密切配合，这样才能打造⼀个顺滑的基建结果

2，plugin-transform-runtime 会根据 sourceType 选择注⼊ import 或者 require，sourceType 的默认值是 module，就会默认注⼊ import

3，Webpack 不会处理包含 import/export 的⽂件中的 module.exports 导出，所以需要让 Babel ⾃动判断 sourceType，根据⽂件内是否存在 import/export 来决定注⼊什么样的代码

4，应用项目构建和公共库构建的差异

- 公共库可能被各种环境所引用或需要支持各种兼容需求，因此**公共库就要兼容性能和易用性，要注意质量和广泛度**

### 一个企业级公共库的设计原则

> 企业级公共库主要是指在企业内复⽤的公共库，它可以被发布到 npm 上进⾏社区共享，也可以在企业内的私有 npm 中限定范围地共享。总之，企业级公共库是需要在业务中被使⽤的。

⼀个企业级公共库的设计原则应该包括以下⼏点:

1，对于开发者共创公共库，最大化确保开发体验

- 最快地搭建调试和开发环境
- 安全地发版维护

2，对于使⽤者，最⼤化确保使⽤体验：

- 公共库文档建设完善
- 公共库质量有保障
- 接入和使用负担最小

在团队⾥，设计⼀个公共库前，你需要考虑：

1，⾃研公共库还是使⽤社区已有轮⼦；

2，公共库的运⾏环境是什么，这将决定公共库的编译构建⽬标；

3，公共库是偏向业务还是业务 free，这将决定公共库的**职责**和**边界**

### 制定统一标准化 babel-preset

1，企业中，所有公共库或应⽤项⽬都使⽤⼀套 @fujia/babel-xxx-preset，按照 @fujia/babel-xxx-preset 的编译要求进⾏编译，这样业务使⽤时，接⼊标准统⼀

## 问答

1，审视手上的项目，编译构建过程是否做到最高效？产出代码是否达到了最高级别的安全保障？是否做到了性能体验的最佳实践？

2，作为公共库，应该如何构建编译代码，让业务方更有保障的使用？

3，作为使用者，应该如何处理第三方公共库，是否还需要对其进行额外编译和处理

4，公共库适配环境是什么？

- 一般来说，可能需要兼容：浏览器/node.js/同构环境等
- 不同的环境对应了不同的编译和打包标准

5，如果⽬标是浏览器环境，那么如何才能充分实现性能最优解？如帮助业务⽅实现 tree-shaking 等优化技术。

## 知识点

1，为了减轻业务使用负担，作为企业公共库，以及对应使用这些企业级公共库的应用项目，可以指定标准规范的 babel-preset, **保证编译产出的统一**

## 小结
