# 脚手架发布

> 脚手架发布模块架构设计和核心流程开发

1，要点

- 脚手架发布模块的整体架构设计和实现原理
- 前端发布流程

2，内容

- 项目发布流程整体架构设计
- 脚手架发布流程的git自动化流程设计
- 脚手架云构建+云发布设计

3，学习方法

- 沉下心，亲自动手画图和**深度思考**
- 自我提问：如果让你设计，你会怎么做？

4，注意点

- 需具备一定计算机和操作系统基础，发布过程是一个综合各领域知识的过程
- Git Flow流程需具备较好的git操作基础

## 脚手架发布架构设计

1，发布的功能的主要目的：在开发的过程中，帮助开发者快速实现项目的上线和快速迭代

2，没有脚手架的话，发布可能依赖后端或运维的同学进行发布，有了脚手架之后，前端发布就不再依赖服务端或运维的同学，全部由前端控制

### 步骤/流程

#### init

1，预检查 - 保障发布环境

> 发布的过程中并不能保证项目处于ready的状态
> 不推荐在执行的过程中才抛出异常，造成不好的用户体验

**在最开始的时候，就保证整个运行环境是OK的**

- 是否是一个前端项目
- 操作系统中，是否存在.stage-cli缓存目录

#### todo - 执行  发布逻辑

1，git flow自动化

- init

- todo

- finish

2，云构建

- init

> 初始化，如：创建websocket连接，检查当前的构建环境，检查构建产物等

- todo

> 具体的构建逻辑，如：npm install, npm run build等流程

- finish

> 云发布的逻辑是包含在一块的

3，云发布

> 云发布是集成在云构建中的

- init

> 检查发布的条件是否具备，发布的产物是否已经生成

- todo

> 上传OSS，绑定cdn

- finish

> 删除远程分支，创建远程tag

#### finish - 发布完成后执行的逻辑

## git flow

## 云构建

1，云构建会建立一个远程的websocket连接

2，.git_publish

主要用途是标识发布所选取的静态资源平台，可以是OSS或自己搭建的平台

3，CloudBuild类

- 调用远程websocket服务
- 完成云构建
- 远程交互

## 云发布

> 工作就是将静态资源上传到OSS

## 知识点

1，架构设计：第一步是设计结构，设计流程，而不是设计具体的细节

2，先确定整个架构框架，之后不管执行什么流程或功能，都是该架构体系之下新增，**这与做产品功能设计是有很大的区别的**， 从架构上保证整个产品的兼容性和流程的合理性，未来更多的流程都可以在架构下找到落地环节

3，架构设计很重要的一个步骤除了架构设计之外，就是梳理思路，把思路变得清晰，你就知道当前你处于哪一个流程中完成什么功能，他对整体有什么影响，这是一个系统思考的模型

4，在架构设计时，尽量考虑清楚全面，否则开发时会出现功能缺失

5，架构师在项目架构的阶段，需要帮助开发工程师考虑各种情况，这也是架构师与普通开发工程师的区别，预先先要预计到可能的问题，并且之前有所涉及，这就是体现架构师的架构能力的地方
